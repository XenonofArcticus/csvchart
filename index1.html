<!DOCTYPE html>

<html>
<head>
	<title>Read Text File</title>

	<!--
	<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="papaparse.js"></script>
	-->

	<link href="lib/bootstrap-3.1.1.min.css" rel="stylesheet">

	<script type="text/javascript" src="lib/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="lib/bootstrap-3.1.1.min.js"></script>
	<script type="text/javascript" src="lib/papaparse.min.js"></script>
	<script type="text/javascript" src="lib/google-charts-loader.js"></script>

	<script type="text/javascript">
		google.charts.load("current", {"packages": ["corechart"]});
		// google.charts.setOnLoadCallback(drawChart);

		function drawChart(d) {
			var dataTable = new google.visualization.DataTable();

			dataTable.addColumn("number", "Search Volume");
			dataTable.addColumn("number", "Keyword Difficulty");
			dataTable.addColumn({type: "string", role: "tooltip"});

			dataTable.addRows(d);

			var options = {
				title: "AlphaPixel CSVChart",
				// hAxis: {title: "Search Volume", minValue: 0, maxValue: 15, logScale: true},
				hAxis: {logScale: true},
				//vAxis: {title: "Keyword Difficulty", minValue: 0, maxValue: 15, logScale: false},
				legend: "none"
			};

			var chart_div = document.getElementById('chart_div');
			var chart = new google.visualization.ScatterChart(chart_div);

			// var options = { legend: "none" };
			// var chart = new google.visualization.ColumnChart(document.getElementById("chart_div"));

			chart.draw(dataTable, options);
		}

		// https://developers.google.com/chart/interactive/docs/gallery/scatterchart
		function drawChartOLD(d) {
			var data = google.visualization.arrayToDataTable(d);

			/* var data = google.visualization.arrayToDataTable([
				["Age", "Weight"],
				[8, 12],
				[4, 5.5],
				[11, 14],
				[4, 5],
				[3, 3.5],
				[6.5, 7]
			]); */

			var options = {
				title: "AlphaPixel Test",
				hAxis: {title: "Foo", minValue: 0, maxValue: 15, logScale: true},
				vAxis: {title: "Bar", minValue: 0, maxValue: 15, logScale: false},
				legend: "none"
			};

			var chart_div = document.getElementById('chart_div');
			var chart = new google.visualization.ScatterChart(chart_div);

			// https://developers.google.com/chart/interactive/docs/printing
			/* google.visualization.events.addListener(chart, 'ready', function () {
				chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
			}); */

			chart.draw(data, options);
		}

		var csv;
	</script>

	<script type="text/javascript">
		// https://codepen.io/claviska/pen/jOzORQ?editors=1010
		$(function() {
			// Attach the "fileselect" event to all file inputs on the page.
			$(document).on("change", ":file", function() {
				var input = $(this),

				numFiles = input.get(0).files ? input.get(0).files.length : 1,
				label = input.val().replace(/\\/g, "/").replace(/.*\//, "");

				input.trigger("fileselect", [numFiles, label]);
			});

			// Watch for our custom event from above.
			$(document).ready(function() {
				$(":file").on("fileselect", function(event, numFiles, label) {
					var input = $(this).parents(".input-group").find(":text"),

					log = numFiles > 1 ? numFiles + " files selected" : label;

					if(input.length) input.val(log);

					// TODO: Handle error!
					/* else {
						if(log) alert(log);
					} */
				});
			});
		});
	</script>
</head>
<body>
	<!--
	<input type="file" name="inputfile" id="inputfile">
	<br>
	<pre id="output"></pre>
	<div id="chart_div" style="width: 900px; height: 500px;"></div>
	-->

	<div class="container" style="margin-top: 20px;">
	<div class="row">
		<div class="col-lg-6 col-sm-6 col-12">
			<div class="jumbotron">
				<h3>AlphaPixel CSV Chart</h3>
			</div>
		</div>

		<div class="col-lg-6 col-sm-6 col-12">
			<h4>CSV File(s)</h4>
			<div class="input-group">
				<label class="input-group-btn">
					<span class="btn btn-primary">
						<!-- Browse&hellip; <input type="file" style="display: none;" multiple> -->
						Select&hellip; <input type="file" style="display: none;" name="inputfile" id="inputfile">
					</span>
				</label>
				<input type="text" class="form-control" readonly>
			</div>

			<span class="help-block">
				You may select one or more CSV files.
			</span>
		</div>
	</div>
	</div>

	<!-- <div id="chart_div" style="width: 900px; height: 500px;"></div> -->
	<div id="chart_div" style="width: 100%; height: 100%;"></div>

	<script type="text/javascript">
		document.getElementById("inputfile").addEventListener("change", function() {
			var fr = new FileReader();

			// https://www.papaparse.com/docs#config
			fr.onload = function() {
				/* csv = Papa.parse(fr.result, {
					dynamicTyping: true,
					skipEmptyLines: true
				}); */

				csv = Papa.parse(fr.result, {
					dynamicTyping: true,
					skipEmptyLines: true,
					header: true
				}).data.map(e => [
					e["Search Volume"],
					e["Keyword Difficulty"],
					e["Keyword"]
				]);

				// csv = [["FOO", "BAR", "BAZ"], ...csv];

				// document.getElementById("output").textContent = fr.result;
				// document.getElementById("output").textContent = csv;
				console.log(csv, JSON.stringify(csv))

				// drawChart(csv.data);
				drawChart(csv);
			}

			fr.readAsText(this.files[0]);
		})
	</script>
</body>
</html>
