<!DOCTYPE html>

<html>
<head>
	<title>AlphaPixel CSVChart (ChartJS)</title>

	<!--
	<link href="https://netdna.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="papaparse.js"></script>
	-->

	<link href="lib/bootstrap-5.1.3.min.css" rel="stylesheet">

	<script type="text/javascript" src="lib/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="lib/bootstrap-5.1.3.min.js"></script>
	<script type="text/javascript" src="lib/papaparse.min.js"></script>

	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
</head>
<body>
	<div class="container" style="margin-top: 20px;">
	<div class="row">
		<div class="col-lg-6 col-sm-6 col-12">
			<img src="logo.png"/>
		</div>

		<div class="col-lg-6 col-sm-6 col-12">
			<h4>CSV File(s)</h4>
			<div class="input-group">
				<label class="input-group-btn">
					<span class="btn btn-primary">
						<!-- Browse&hellip; <input type="file" style="display: none;" multiple> -->
						Select&hellip; <input type="file" style="display: none;" name="inputfile" id="inputfile">
					</span>
				</label>
				<input type="text" class="form-control" readonly>
			</div>

			<span class="help-block">
				You may select one or more CSV files.
			</span>
		</div>
	</div>
	</div>

	<hr class="divider: 1px dashed light"/>

	<!-- <div id="chart_div" style="width: 900px; height: 500px;"></div> -->
	<!-- <div id="chart_div" style="width: 100%; height: 100%;"></div> -->
	<!-- <div id="chart_div"/> -->

	<canvas id="myChart" width="400" height="300"></canvas>

	<script type="text/javascript">
		// https://www.chartjs.org/docs/latest/charts/scatter.html
		// https://chartjs-plugin-datalabels.netlify.app/guide/
		// Chart.register(ChartDataLabels);

		function drawChart(d) {
			const ctx = document.getElementById('myChart').getContext('2d');

			const data = {
				datasets: [{
					label: 'Scatter Dataset',
					data: d, /*[
						{ x: 1, y: 1 },
						{ x: 3, y: 3 },
						{ x: 6, y: 6 }
					], */
					backgroundColor: 'rgb(255, 99, 132)'
				}]
			};

			const myChart = new Chart(ctx, {
				type: 'scatter',
				// plugins: [ChartDataLabels],
				data: data
				/* options: { plugins: {
					datalabels: {
						// color: 'red',
						formatter: function(e) {
							console.log("----------------- begin");
							console.log(e);
							console.log("----------------- end");

							return e.z;
						}
					}
				}} */
			});
		}

		document.getElementById("inputfile").addEventListener("change", function() {
			var fr = new FileReader();

			// https://www.papaparse.com/docs#config
			fr.onload = function() {
				var csv = Papa.parse(fr.result, {
					dynamicTyping: true,
					skipEmptyLines: true,
					header: true
				}).data.map(e => { return {
					"x": e["Search Volume"],
					"y": e["Keyword Difficulty"],
					"label": e["Keyword"]
				}});

				// document.getElementById("output").textContent = csv;
				console.log(csv, JSON.stringify(csv))

				drawChart(csv);
			}

			fr.readAsText(this.files[0]);
		})
	</script>
</body>
</html>
